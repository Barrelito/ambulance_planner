<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <title>Samordnare Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<nav class="navbar navbar-dark bg-primary mb-4">
    <div class="container">
        <span class="navbar-brand mb-0 h1">üìä Samordnare Dashboard</span>
        <a href="/" class="btn btn-light btn-sm">Tillbaka till Planering</a>
    </div>
</nav>

<div class="container pb-5">

    <div class="card shadow-sm mb-4">
        <div class="card-body bg-white py-3">
            <form action="/dashboard" method="GET" class="row g-2 align-items-end">
                <div class="col-md-12 mb-2">
                    <span class="fw-bold text-muted text-uppercase small">Filtrera statistik & vakanser:</span>
                </div>
                
                <div class="col-md-3">
                    <label class="small text-muted fw-bold">Station</label>
                    <select name="station_id" class="form-select form-select-sm">
                        <option value="0" {% if sel_station_id == 0 %}selected{% endif %}>-- Alla Stationer --</option>
                        {% for station in stations %}
                            {% if 'BLANKPASS' not in station.name %}
                                <option value="{{ station.id }}" {% if sel_station_id == station.id %}selected{% endif %}>{{ station.name }}</option>
                            {% endif %}
                        {% endfor %}
                    </select>
                </div>

                <div class="col-md-2">
                    <label class="small text-muted">√Ör</label>
                    <input type="number" name="year" class="form-control form-control-sm" value="{{ sel_year }}">
                </div>

                <div class="col-md-3">
                    <label class="small text-muted">M√•nad</label>
                    <select name="month" class="form-select form-select-sm">
                        <option value="0" {% if sel_month == 0 %}selected{% endif %}>-- Alla / Ignorera --</option>
                        <option value="1" {% if sel_month == 1 %}selected{% endif %}>Januari</option>
                        <option value="2" {% if sel_month == 2 %}selected{% endif %}>Februari</option>
                        <option value="3" {% if sel_month == 3 %}selected{% endif %}>Mars</option>
                        <option value="4" {% if sel_month == 4 %}selected{% endif %}>April</option>
                        <option value="5" {% if sel_month == 5 %}selected{% endif %}>Maj</option>
                        <option value="6" {% if sel_month == 6 %}selected{% endif %}>Juni</option>
                        <option value="7" {% if sel_month == 7 %}selected{% endif %}>Juli</option>
                        <option value="8" {% if sel_month == 8 %}selected{% endif %}>Augusti</option>
                        <option value="9" {% if sel_month == 9 %}selected{% endif %}>September</option>
                        <option value="10" {% if sel_month == 10 %}selected{% endif %}>Oktober</option>
                        <option value="11" {% if sel_month == 11 %}selected{% endif %}>November</option>
                        <option value="12" {% if sel_month == 12 %}selected{% endif %}>December</option>
                    </select>
                </div>

                <div class="col-md-2">
                    <label class="small text-muted">Vecka (Prio)</label>
                    <input type="number" name="week" class="form-control form-control-sm" placeholder="1-52" value="{{ sel_week if sel_week > 0 else '' }}">
                </div>

                <div class="col-md-2">
                    <button type="submit" class="btn btn-primary btn-sm w-100">Uppdatera</button>
                </div>
                
                <div class="col-12 text-end mt-2">
                    <a href="/dashboard" class="text-decoration-none small text-muted">rensa filter</a>
                </div>
            </form>
        </div>
    </div>

    <div class="mb-3 text-center">
        <h4 class="text-secondary">Visar: <span class="text-dark fw-bold">{{ filter_label }}</span></h4>
    </div>

    <div class="row mb-4">
        <div class="col-md-6">
            <div class="card text-center shadow-sm border-danger">
                <div class="card-body">
                    <h3 class="display-4 text-danger">{{ vacancy_count }}</h3>
                    <p class="text-muted">Vakanser (Urvalet)</p>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card text-center shadow-sm border-success">
                <div class="card-body">
                    <h3 class="display-4 text-success">{{ fill_rate }}%</h3>
                    <p class="text-muted">Bel√§ggningsgrad (Urvalet)</p>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-7">
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-danger text-white d-flex justify-content-between align-items-center">
                    <h5 class="m-0">üö® Vakanslista (Att g√∂ra)</h5>
                </div>
                <div class="card-body p-0">
                    <div style="max-height: 600px; overflow-y: auto;">
                        <table class="table table-striped table-hover mb-0">
                            <thead class="table-light sticky-top">
                                <tr>
                                    <th>Datum</th>
                                    <th>Plats</th>
                                    <th>Period</th>
                                    <th>Saknas</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for v in vacancies %}
                                <tr>
                                    <td class="fw-bold">{{ v.date }}</td>
                                    <td>
                                        <div>{{ v.station }}</div>
                                        <small class="text-muted">{{ v.unit }}</small>
                                    </td>
                                    <td>
                                        <span class="badge bg-secondary">{{ v.period }}</span>
                                        <br><small>{{ v.time }}</small>
                                    </td>
                                    <td>
                                        <div class="text-danger fw-bold">{{ v.missing }}</div>
                                        {% if v.applicants > 0 %}
                                            <span class="badge bg-success mt-1">üåü {{ v.applicants }} s√∂kande</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <a href="/?date={{ v.date }}" class="btn btn-sm btn-outline-primary">G√• till ‚û°Ô∏è</a>
                                    </td>
                                </tr>
                                {% else %}
                                <tr>
                                    <td colspan="5" class="text-center py-4 text-success">
                                        <h5>üéâ Inga vakanser i urvalet!</h5>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-5">
            
            <div class="mb-3">
                <a href="/scheduler" class="btn btn-warning w-100 fw-bold shadow-sm py-2 text-uppercase">
                    üìÖ G√• till Schemal√§ggaren (Massbokning)
                </a>
            </div>

            <div class="card shadow-sm mb-4">
                <div class="card-header bg-primary text-white">
                    <h5 class="m-0">üë§ Hantera Personal</h5>
                </div>
                <div class="card-body">
                    <form action="/admin/add_user" method="POST" class="mb-4 border-bottom pb-4 bg-white p-3 rounded border">
                        <h6 class="mb-3 text-primary">L√§gg till ny medarbetare</h6>
                        <div class="row g-2">
                            <div class="col-12"><label class="form-label small fw-bold text-muted">Namn</label><input type="text" name="name" class="form-control" placeholder="F√∂r- och efternamn" required></div>
                            <div class="col-6"><label class="form-label small fw-bold text-muted">Hemstation</label><select name="home_station" class="form-select"><option value="Pool">Pool (Ingen fast)</option>{% for station in stations %}<option value="{{ station.name }}">{{ station.name }}</option>{% endfor %}</select></div>
                            <div class="col-6"><label class="form-label small fw-bold text-muted">Roll</label><select name="role" class="form-select"><option value="AMB">AMB</option><option value="VUB">VUB</option></select></div>
                            <div class="col-12 mt-2"><div class="form-check"><input class="form-check-input" type="checkbox" name="has_sits" id="sitsCheck"><label class="form-check-label" for="sitsCheck">Har SITS-kompetens</label></div></div>
                            <div class="col-12 mt-1">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" name="has_c1" id="c1Check" checked>
                                    <label class="form-check-label" for="c1Check">Har C1-k√∂rkort</label>
                                </div>
                            </div>
                            
                            <div class="col-12 mt-3"><button type="submit" class="btn btn-success w-100">L√§gg till i listan</button></div>
                        </div>
                    </form>
                    <h6 class="text-muted small fw-bold">Befintlig Personal</h6>
                    <div style="max-height: 400px; overflow-y: auto;">
                        <table class="table table-sm table-hover" style="font-size: 0.9em;">
                            <thead class="table-light sticky-top"><tr><th>Namn</th><th>Roll</th><th>Station</th><th>SITS</th><th></th></tr></thead>
                            <tbody>
                                {% for user in users %}
                                <tr><td>{{ user.name }}</td><td>{{ user.role }}</td><td>{{ user.home_station }}</td><td>{% if user.has_sits %}‚úÖ{% endif %}</td><td class="text-end"><a href="/admin/delete_user/{{ user.id }}" class="text-danger text-decoration-none" onclick="return confirm('Radera {{ user.name }}?')">üóëÔ∏è</a></td></tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>